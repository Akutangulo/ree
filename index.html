<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚡</text></svg>"><!-- favicon -->
    <title>Precio por hora de la electricidad en España a través de la API de Red Eléctrica Española</title>
</head>
<body>
    <div id="electricity-container"></div>
    <a href="https://akutangulo.com" target="_blank" rel="noopener" title="Akutangulo.com">Akutangulo.com</a>
</body>

<script>
  // Obtener la fecha actual
var currentDate = new Date();

// Obtener la fecha de mañana
var tomorrowDate = new Date();
tomorrowDate.setDate(currentDate.getDate() + 1);

// Formatear las fechas en el formato necesario (YYYY-MM-DDTHH:mm) ISO 8601
var startDate = formatDate(currentDate) + "T00:00";
var endDate = formatDate(tomorrowDate) + "T23:59";

// Construir la URL de la API con las fechas dinámicas
var apiUrl = "https://apidatos.ree.es/es/datos/mercados/precios-mercados-tiempo-real?start_date=" + startDate + "&end_date=" + endDate + "&time_trunc=hour";

// Función para formatear la fecha en el formato YYYY-MM-DD 
function formatDate(date) {
  var year = date.getFullYear();
  var month = (date.getMonth() + 1).toString().padStart(2, "0");
  var day = date.getDate().toString().padStart(2, "0");
  return year + "-" + month + "-" + day;
}

// Obtener el contenedor donde se mostrarán los precios
var container = document.getElementById('electricity-container');

// Obtener los datos de la API
fetch(apiUrl)
  .then(response => response.json())
  .then(data => {
    // Obtener los datos de los precios de electricidad
    var pricesData = data.included.find(item => item.type === 'PVPC (\u20ac/MWh)').attributes.values;

    // Obtener la hora actual
    var currentHour = new Date().getHours();

    // Recorrer los datos y agregar divs al contenedor
    pricesData.forEach(function(item, index) {
      var datetime = new Date(item.datetime);
      var price = item.value.toFixed(2);
      var div = document.createElement('div');

      // Crear elementos span para mostrar la hora y el precio
      var timeSpan = document.createElement('span');
      if (index === currentHour) {
        var clockSpan = document.createElement('span');
        clockSpan.id = 'clock';
        timeSpan.appendChild(clockSpan);
      } else {
        timeSpan.innerHTML  = getCurrentTime(datetime);
      }
      
      var priceSpan = document.createElement('span');
      priceSpan.innerHTML = (price / 1000).toFixed(3) + ' € por Kilovatio';
      
      // Agregar los elementos span al div y el div al contenedor
      div.appendChild(timeSpan);
      div.appendChild(document.createElement('br'));
      div.appendChild(priceSpan);
      container.appendChild(div);
    });

    // Actualizar el reloj cada segundo
    setInterval(updateClock, 1000);
  })
  .catch(error => console.log('Error:', error));

// Función para obtener la hora actual en formato HH:00
function getCurrentTime(date) {
  var formattedHours = date.getHours().toString().padStart(2, '0');
  return `${formattedHours}:00`;
}

// Función para actualizar el reloj cada segundo
function updateClock() {
  var clockElement = document.getElementById('clock');
  if (clockElement) {
    var currentTime = new Date();
    var formattedTime = currentTime.getHours().toString().padStart(2, '0') + ':' +
                        currentTime.getMinutes().toString().padStart(2, '0') + ':' +
                        currentTime.getSeconds().toString().padStart(2, '0');
    clockElement.textContent = formattedTime;
  }
}
</script>
</html>
